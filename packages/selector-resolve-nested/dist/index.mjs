import e from"postcss-selector-parser";function sourceFrom(e){return{sourceIndex:e.sourceIndex??0,source:e.source}}function sortCompoundSelectorsInsideComplexSelector(o){const r=[];let t=[];o.each((o=>{if("combinator"===o.type)return r.push(t,[o]),void(t=[]);if(e.isPseudoElement(o))return r.push(t),void(t=[o]);if("universal"===o.type&&t.find((e=>"universal"===e.type)))o.remove();else{if("tag"===o.type&&t.find((e=>"tag"===e.type))){o.remove();const r=e.pseudo({value:":is",...sourceFrom(o)});return r.append(e.selector({nodes:[o],value:"",...sourceFrom(o)})),void t.push(r)}t.push(o)}})),r.push(t);const s=[];for(let e=0;e<r.length;e++){const o=r[e];o.sort(((e,o)=>selectorTypeOrder(e)-selectorTypeOrder(o))),s.push(...o)}o.removeAll();for(let e=s.length-1;e>=0;e--)s[e].remove(),o.prepend(s[e])}function selectorTypeOrder(r){return e.isPseudoElement(r)?o.pseudoElement:o[r.type]}const o={universal:0,tag:1,pseudoElement:2,nesting:3,id:4,class:5,attribute:6,pseudo:7,comment:8};function resolveNestedSelector(o,r){const t=[];for(let s=0;s<o.nodes.length;s++){const n=o.nodes[s].clone();{let o=!1;n.walkNesting((()=>(o=!0,!1))),o?"combinator"===n.nodes[0]?.type&&n.prepend(e.nesting({...sourceFrom(n)})):(n.prepend(e.combinator({value:" ",...sourceFrom(n)})),n.prepend(e.nesting({...sourceFrom(n)})))}{const e=new Set;n.walkNesting((o=>{const t=o.parent;e.add(t),"pseudo"===t.parent?.type&&":has"===t.parent.value?.toLowerCase()?o.replaceWith(...prepareParentSelectors(r,!0)):o.replaceWith(...prepareParentSelectors(r))}));for(const o of e)sortCompoundSelectorsInsideComplexSelector(o)}n.walk((e=>{"combinator"===e.type&&""!==e.value.trim()?(e.rawSpaceAfter=" ",e.rawSpaceBefore=" "):(e.rawSpaceAfter="",e.rawSpaceBefore="")})),t.push(n)}return e.root({nodes:t,value:"",...sourceFrom(o)})}function prepareParentSelectors(o,r=!1){return r||!isCompoundSelector(o.nodes)?[e.pseudo({value:":is",nodes:o.nodes.map((e=>e.clone())),...sourceFrom(o)})]:o.nodes[0].nodes.map((e=>e.clone()))}function isCompoundSelector(o){return 1===o.length&&!o[0].nodes.some((o=>"combinator"===o.type||e.isPseudoElement(o)))}export{resolveNestedSelector};
